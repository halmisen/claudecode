# 上下文管理指南
# 管理开发过程中的上下文使用

## 目的
本指南帮助管理开发过程中的上下文窗口使用：
- 监控对话长度和复杂度
- 提供及时的清理建议
- 追踪上下文使用模式
- 提供优化建议

## 触发条件
- 对话超过15条消息时
- 在切换主要任务时
- 当响应时间明显变慢时
- 开始新的复杂任务前

## 监控标准

### 对话长度指标
- **消息数量**：计算自上次清理后的消息数
- **任务复杂度**：追踪是否在讨论多个不相关的主题
- **文件操作**：监控修改/创建的文件数量
- **响应时间**：注意响应是否变慢

### 上下文压力信号
- 响应变得不够详细
- 频繁的工具使用错误
- 内存/文件访问延迟
- 响应不完整

## 建议

### 何时建议清理
```python
# 决策逻辑伪代码
if message_count > 15:
    suggest_compact()
elif task_switch_detected and message_count > 8:
    suggest_compact()
elif response_time > average_time * 1.5:
    suggest_compact()
elif file_operations > 10:
    suggest_compact()
```

### 清理命令模板
```
# 通用清理
/compact

# 任务聚焦清理
/compact focus on [当前任务]

# 主题特定清理
/compact focus on [主题] and [相关文件]
```

## 使用说明

### 开发者使用
1. **监控对话**：追踪消息数量和任务进度
2. **检查响应质量**：注意响应质量是否下降
3. **识别任务边界**：注意在切换不同类型工作时
4. **提供及时建议**：在适当时机建议清理

### 示例建议
- "您自上次清理已有18条消息。考虑使用 `/compact` 优化上下文。"
- "正在从git操作切换到编码。使用 `/compact focus on Python development` 清理上下文。"
- "注意到响应时间变慢。使用 `/compact` 可能有助于提高性能。"
- "开始新的复杂任务。考虑先使用 `/compact` 获得新的上下文。"

## 最佳实践

### 清理时机
- **新任务前**：在开始复杂工作前清理上下文
- **完成里程碑后**：在完成主要部分后清理
- **切换主题时**：在改变主题时使用聚焦清理
- **性能问题时**：如果响应变慢则清理

### 聚焦领域
- **当前任务**：专注于正在进行的工作
- **相关文件**：包含最近修改的文件
- **关键概念**：保持重要的技术概念
- **项目上下文**：保留项目特定信息

## 与CLAUDE.md集成
在主CLAUDE.md中添加此引用：

```
## 上下文管理
- 使用 `/context-check` 评估当前上下文使用情况
- 遵循上下文管理指南的建议
- 在长开发会话中定期清理
- 在切换任务时使用聚焦清理
```

## 命令
- `/context-check`：分析当前对话并提供清理建议
- `/context-stats`：显示当前上下文使用统计
- `/compact-help`：获取上下文管理最佳实践帮助