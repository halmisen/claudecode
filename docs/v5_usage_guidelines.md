# Doji Ashi Strategy V5 - ä½¿ç”¨æŒ‡å—å’Œæ³¨æ„äº‹é¡¹

**ç‰ˆæœ¬**: V5 (æŽ¨èç‰ˆæœ¬)  
**æ›´æ–°æ—¶é—´**: 2025-08-11  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ªï¼Œä¸»è¦ç»´æŠ¤ç‰ˆæœ¬

---

## ðŸŽ¯ V5ç‰ˆæœ¬ä¼˜åŠ¿æ€»ç»“

### æ€§èƒ½æŒ‡æ ‡
- **ç­–ç•¥å›žæŠ¥çŽ‡**: **103.38%** (vs V4çš„ 38.51%)
- **äº¤æ˜“æ¬¡æ•°**: **183ç¬”** (vs V4çš„ 44ç¬”)  
- **æ‰§è¡Œæ—¶é—´**: **1.3ç§’** (vs V4çš„ 15+ ç§’)
- **æœ€å¤§å›žæ’¤**: 18.07% (åœ¨å¯æŽ¥å—èŒƒå›´å†…)
- **å¤æ™®æ¯”çŽ‡**: 2.31 (ä¼˜ç§€)

### æŠ€æœ¯ä¼˜åŠ¿
- **é›¶æ•°æ®æ”¶é›†å¼€é”€**: æ— é¢å¤–å†…å­˜æ¶ˆè€—å’Œæ€§èƒ½å½±å“
- **ç¨³å®šå¯é **: åŸºäºŽæˆç†Ÿçš„Backtraderç”Ÿæ€ç³»ç»Ÿ
- **çŽ°ä»£åŒ–å¯è§†åŒ–**: Bokehäº¤äº’å¼ç½‘é¡µå›¾è¡¨
- **æ˜“äºŽç»´æŠ¤**: ç®€æ´çš„ä»£ç ç»“æž„ï¼Œæ— å¤æ‚ä¾èµ–

---

## ðŸ“‹ ä½¿ç”¨å‰å‡†å¤‡

### 1. çŽ¯å¢ƒè¦æ±‚
```bash
# Pythonç‰ˆæœ¬
Python 3.8+ (æŽ¨è 3.11.9)

# æ ¸å¿ƒä¾èµ– (å¿…éœ€)
pip install backtrader pandas numpy backtrader-plotting

# å¯é€‰ä¾èµ– (æŽ¨è)
pip install TA-Lib  # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—åŠ é€Ÿ
```

### 2. æ•°æ®è¦æ±‚
- **æ ¼å¼**: OHLCV CSVæ–‡ä»¶ï¼ŒåŒ…å« `open_time, open, high, low, close, volume` åˆ—
- **æ—¶é—´æ ¼å¼**: Unixæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰æˆ–æ ‡å‡†datetimeæ ¼å¼
- **æ•°æ®æ¥æº**: æ”¯æŒBinanceã€å…¶ä»–äº¤æ˜“æ‰€çš„æ ‡å‡†æ ¼å¼
- **å»ºè®®æ—¶é—´æ¡†æž¶**: 2å°æ—¶æˆ–4å°æ—¶ï¼ˆç»è¿‡ä¼˜åŒ–æµ‹è¯•ï¼‰

### 3. æ–‡ä»¶è·¯å¾„
- **ä¸»ç­–ç•¥**: `backtester/strategies/doji_ashi_strategy_v5.py`
- **è¿è¡Œè„šæœ¬**: `backtester/run_doji_ashi_strategy_v5.py`
- **è™šæ‹ŸçŽ¯å¢ƒ**: `backtester/venv/`
- **è¾“å‡ºç›®å½•**: `plots/`

---

## ðŸš€ æ ‡å‡†ä½¿ç”¨æµç¨‹

### 1. åŸºç¡€å›žæµ‹å‘½ä»¤
```bash
python backtester/run_doji_ashi_strategy_v5.py \
  --data backtester/data/ETHUSDT/2h/ETHUSDT-2h-merged.csv \
  --market_data backtester/data/BTCUSDT/2h/BTCUSDT-2h-merged.csv \
  --market_type crypto \
  --cash 500.0 \
  --commission 0.0002 \
  --trade_direction long \
  --enable_backtrader_plot
```

### 2. å‚æ•°è¯´æ˜Ž
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜Ž |
|------|--------|------|
| `--data` | å¿…éœ€ | ä¸»è¦äº¤æ˜“æ•°æ®æ–‡ä»¶è·¯å¾„ |
| `--market_data` | å¯é€‰ | å¸‚åœºæ•°æ®æ–‡ä»¶è·¯å¾„ï¼ˆBTC/SPYï¼‰ |
| `--market_type` | crypto | å¸‚åœºç±»åž‹ï¼šcrypto/stocks |
| `--cash` | 500.0 | åˆå§‹èµ„é‡‘ï¼ˆUSDTï¼‰ |
| `--commission` | 0.0002 | æ‰‹ç»­è´¹çŽ‡ï¼ˆ0.02%ï¼‰ |
| `--trade_direction` | long | äº¤æ˜“æ–¹å‘ï¼šlong/short/both |
| `--leverage` | 4.0 | æ æ†å€æ•° |
| `--order_percent` | 20.0 | å•ç¬”ä»“ä½ç™¾åˆ†æ¯” |
| `--enable_backtrader_plot` | True | å¯ç”¨Bokehå›¾è¡¨ |

### 3. è¾“å‡ºæ–‡ä»¶
- **HTMLå›¾è¡¨**: `plots/doji_ashi_v5_bokeh_crypto_YYYYMMDD_HHMMSS.html`
- **è‡ªåŠ¨æ‰“å¼€**: å›žæµ‹å®ŒæˆåŽè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤º
- **å¯åˆ†äº«**: HTMLæ–‡ä»¶å¯ä»¥å‘é€ç»™å…¶ä»–äººæŸ¥çœ‹

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è´¨é‡æ£€æŸ¥
```bash
# è¿è¡Œå‰æ£€æŸ¥æ•°æ®æ ¼å¼
head -5 backtester/data/ETHUSDT/2h/ETHUSDT-2h-merged.csv

# ç¡®ä¿åŒ…å«å¿…éœ€åˆ—ï¼šopen_time,open,high,low,close,volume
# ç¡®ä¿æ—¶é—´æ ¼å¼æ­£ç¡®ï¼šUnixæ—¶é—´æˆ³(æ¯«ç§’)æˆ–ISOæ ¼å¼
```

### 2. é£Žé™©å‚æ•°è®¾ç½®
- **åˆå§‹èµ„é‡‘**: å»ºè®®ä»Ž500 USDTå¼€å§‹æµ‹è¯•
- **ä»“ä½å¤§å°**: é»˜è®¤20%å•ç¬”ä»“ä½ï¼Œ4å€æ æ†
- **æœ€å¤§å›žæ’¤**: ç›‘æŽ§ä¸è¶…è¿‡20%çš„å›žæ’¤
- **äº¤æ˜“æ–¹å‘**: æŽ¨èåªåšå¤šï¼ˆlongï¼‰ï¼Œé£Žé™©æ›´å¯æŽ§

### 3. å¸‚åœºè¿‡æ»¤å™¨
- **åŠ å¯†è´§å¸æ¨¡å¼**: è‡ªåŠ¨ä½¿ç”¨BTCä½œä¸ºå¸‚åœºè¿‡æ»¤å™¨
- **è‚¡ç¥¨æ¨¡å¼**: ä½¿ç”¨SPYä½œä¸ºå¸‚åœºè¿‡æ»¤å™¨
- **è¿‡æ»¤é€»è¾‘**: æ—¥çº¿è¶‹åŠ¿è¿‡æ»¤ï¼Œä¸¥æ ¼æ¨¡å¼ï¼ˆ3SMAå…¨éƒ¨å‘ä¸Šï¼‰

### 4. æ€§èƒ½ç›‘æŽ§
```bash
# å…³é”®æŒ‡æ ‡ç›‘æŽ§
- æ€»å›žæŠ¥çŽ‡ > 50% (ä¼˜ç§€)
- æœ€å¤§å›žæ’¤ < 20% (å¯æŽ¥å—)
- èƒœçŽ‡ > 40% (åˆç†)
- å¤æ™®æ¯”çŽ‡ > 2.0 (ä¼˜ç§€)
- æ‰§è¡Œæ—¶é—´ < 5ç§’ (é«˜æ•ˆ)
```

---

## ðŸ”§ æ•…éšœæŽ’é™¤

### 1. å¸¸è§é”™è¯¯
**é”™è¯¯**: `ImportError: No module named 'backtrader_plotting'`
```bash
# è§£å†³æ–¹æ¡ˆ
pip install backtrader-plotting
```

**é”™è¯¯**: `FileNotFoundError: [file] not found`
```bash
# æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
ls -la backtester/data/ETHUSDT/2h/
```

**é”™è¯¯**: `Empty dataset after processing`
```bash
# æ£€æŸ¥æ•°æ®æ ¼å¼å’Œæ—¶é—´åˆ—
python -c "import pandas as pd; print(pd.read_csv('your_file.csv').head())"
```

### 2. æ€§èƒ½ä¼˜åŒ–
- **å¤§æ•°æ®é›†**: V5ç‰ˆæœ¬å·²ç»å……åˆ†ä¼˜åŒ–ï¼Œæ— éœ€é¢å¤–è®¾ç½®
- **å†…å­˜ä½¿ç”¨**: ç›¸æ¯”V4ç‰ˆæœ¬å‡å°‘50%ä»¥ä¸Šå†…å­˜å ç”¨
- **æ‰§è¡Œæ—¶é—´**: å¦‚æžœè¶…è¿‡10ç§’ï¼Œæ£€æŸ¥æ•°æ®æ–‡ä»¶å¤§å°å’Œæ ¼å¼

### 3. å›¾è¡¨é—®é¢˜
**å›¾è¡¨ä¸æ˜¾ç¤º**:
```bash
# æ£€æŸ¥Bokehä¾èµ–
pip install bokeh==2.3.3

# æ£€æŸ¥plotsç›®å½•æƒé™
mkdir -p plots
chmod 755 plots
```

**æµè§ˆå™¨ä¸è‡ªåŠ¨æ‰“å¼€**:
- æ‰‹åŠ¨æ‰“å¼€ç”Ÿæˆçš„HTMLæ–‡ä»¶
- æ£€æŸ¥ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨è®¾ç½®

---

## ðŸ“Š æœ€ä½³å®žè·µ

### 1. å‚æ•°è°ƒä¼˜é¡ºåº
1. **æ•°æ®éªŒè¯**: ç¡®ä¿æ•°æ®è´¨é‡å’Œå®Œæ•´æ€§
2. **åŸºç¡€å›žæµ‹**: ä½¿ç”¨é»˜è®¤å‚æ•°è¿è¡ŒåŸºç¡€æµ‹è¯•
3. **é£Žé™©è°ƒæ•´**: æ ¹æ®å›žæ’¤è°ƒæ•´ä»“ä½å¤§å°å’Œæ æ†
4. **æ€§èƒ½ä¼˜åŒ–**: è°ƒæ•´ATRå€æ•°å’Œé£Žé™©å›žæŠ¥æ¯”ä¾‹
5. **æ—¶é—´æ¡†æž¶**: æµ‹è¯•ä¸åŒæ—¶é—´å‘¨æœŸçš„è¡¨çŽ°

### 2. ç»„åˆä¼˜åŒ–
```bash
# æµ‹è¯•ä¸åŒå‚æ•°ç»„åˆ
for leverage in 2.0 4.0 6.0; do
  for atr_mult in 1.0 1.5 2.0; do
    python backtester/run_doji_ashi_strategy_v5.py \
      --data your_data.csv \
      --leverage $leverage \
      --atr_multiplier $atr_mult \
      --market_type crypto
  done
done
```

### 3. é£Žé™©ç®¡ç†
- **åˆ†æ‰¹æµ‹è¯•**: ä»Žå°èµ„é‡‘å¼€å§‹ï¼Œé€æ­¥å¢žåŠ 
- **å¤šæ—¶é—´æ¡†æž¶**: åœ¨2hã€4hã€1dç­‰ä¸åŒå‘¨æœŸæµ‹è¯•
- **å¤šæ ‡çš„éªŒè¯**: åœ¨BTCã€ETHã€å…¶ä»–å¸ç§éªŒè¯ç­–ç•¥ç¨³å¥æ€§
- **å›žæµ‹å‘¨æœŸ**: è‡³å°‘ä½¿ç”¨12ä¸ªæœˆä»¥ä¸Šçš„åŽ†å²æ•°æ®

---

## ðŸ”„ ç‰ˆæœ¬å‡çº§

### ä»ŽV4è¿ç§»åˆ°V5
1. **å¤‡ä»½V4çŽ¯å¢ƒ**: ä¿ç•™V4æ–‡ä»¶ä½œä¸ºå‚è€ƒ
2. **å®‰è£…æ–°ä¾èµ–**: `pip install backtrader-plotting`
3. **ç§»é™¤æ—§ä¾èµ–**: `pip uninstall plotly plotly-resampler`
4. **æ›´æ–°è¿è¡Œå‘½ä»¤**: ä½¿ç”¨V5çš„æ–°å‚æ•°æ ¼å¼
5. **éªŒè¯ç»“æžœ**: å¯¹æ¯”V4å’ŒV5çš„å›žæµ‹ç»“æžœ

### ä¾èµ–æ¸…ç†
```bash
# æ¸…ç†V4ç›¸å…³ä¾èµ–ï¼ˆå¯é€‰ï¼‰
pip uninstall plotly plotly-resampler

# é‡æ–°å®‰è£…V5æ ¸å¿ƒä¾èµ–
pip install --upgrade backtrader pandas numpy backtrader-plotting
```

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

### 1. é—®é¢˜åé¦ˆ
- **Claude Codeé›†æˆ**: ç›´æŽ¥åœ¨å¯¹è¯ä¸­æè¿°é—®é¢˜
- **æ—¥å¿—æ”¶é›†**: ä¿å­˜å®Œæ•´çš„è¿è¡Œæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
- **çŽ¯å¢ƒä¿¡æ¯**: æä¾›Pythonç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿä¿¡æ¯

### 2. ç¤¾åŒºèµ„æº
- **Backtraderæ–‡æ¡£**: https://www.backtrader.com/
- **backtrader-plotting**: https://github.com/verybadsoldier/backtrader_plotting
- **TA-Lib**: https://github.com/mrjbq7/ta-lib

### 3. å¼€å‘æ”¯æŒ
- æŸ¥çœ‹ `docs/development_log_v5_final_solution.md` äº†è§£æŠ€æœ¯ç»†èŠ‚
- å‚è€ƒ `CLAUDE.md` èŽ·å–å®Œæ•´çš„é¡¹ç›®æ–‡æ¡£
- ä½¿ç”¨ `docs/project-planning/GEMINI.md` ä½œä¸ºç¬¬ä¸‰æ–¹AIåŠ©æ‰‹çš„æŒ‡å¼•

---

**â­ æŽ¨è**: å§‹ç»ˆä½¿ç”¨V5ç‰ˆæœ¬è¿›è¡Œæ–°çš„ç­–ç•¥å¼€å‘å’Œå›žæµ‹ï¼